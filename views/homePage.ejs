
<link rel="stylesheet" href="/css/times.css" />

<!-- include header -->
<%- include('include/_header') %>
<!-- /include header -->

<!-- Main Site -->

    
<main>
  <div class="wrapper">

    <img src = "/img/Store-Front.png" class = "store-front" alt = "Store Front" />
  
  <section class="store-info">
    <h1>Naperville North Huskie Store</h1>
    <p>
      The Huskie Store is open on school days Monday through Friday during 4th,
      5th, and 6th period.
    </p>

    <div class="store-hours">
      <h2>Hours</h2>
      <%
      const today = new Date();
      const offset = parseInt(query.offset || 0);
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - today.getDay() + (offset * 14)); // Sunday + offset
      const endDate = new Date(startOfWeek);
      endDate.setDate(startOfWeek.getDate() + 13); // Two weeks
      
      const timesMap = {};
      function localDateString(d) {
        const dt = new Date(d);
        const y = dt.getFullYear();
        const m = String(dt.getMonth() + 1).padStart(2, '0');
        const day = String(dt.getDate()).padStart(2, '0');
        return `${y}-${m}-${day}`;
      }
      times.forEach(time => {
        const dateStr = localDateString(time.date);
        timesMap[dateStr] = time.times;
      });
      %>
      <div class="overflow-wrapper">
        <table class="calendar">
          <thead>
            <tr>
              <th>Sun</th>
              <th>Mon</th>
              <th>Tue</th>
              <th>Wed</th>
              <th>Thu</th>
              <th>Fri</th>
              <th>Sat</th>
            </tr>
          </thead>
          <tbody>
            <% for (let week = 0; week < 2; week++) { %>
              <tr>
                <% for (let day = 0; day < 7; day++) { %>
                  <% 
                  const currentDate = new Date(startOfWeek);
                  currentDate.setDate(startOfWeek.getDate() + week * 7 + day);
                  const dateStr = localDateString(currentDate);
                  const dayTimes = timesMap[dateStr];
                  %>
                  <td class="day"
                    <% if (week === 0 && day === today.getDay()) { %>
                      style="background-color:#fff; font-weight:bold; border: 2px solid #000;"
                    <% } %>
                  >
                    <div class="date"><%= currentDate.getDate() %></div>
                    <% if (dayTimes && dayTimes.length > 0) { %>
                      <ul>
                        <% dayTimes.forEach((slot, index) => { %>
                          <li><%= slot.openTime %> - <%= slot.closeTime %></li>
                        <% }); %>
                      </ul>
                    <% } else { %>
                      <p>Closed</p>
                    <% } %>
                  </td>
                <% } %>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>

    </div>

  </section>

  <img id="imagePreview" alt="Image Preview" style="display:none;">


  <div class = "item-list"> 
    <% items.forEach(function(item) { %>
      <div class = "item" onclick= "window.location.href='/item/<%= item.id %>'">
        <img src="<%= item.image %>">
        <div class = "item-content">
        <h2><%= item.name %></h2>
        <h3>Price: $<%= item.price %></h3>
        <p>Description: <%= item.description %></p>
        </div>
    </div>
    <% }) %>
  </div>
</main>

<!-- /Main Site -->

<script src="/js/homePage.js"></script>

<!-- include footer -->
<%- include('include/_footer') %>
<!-- /include footer -->