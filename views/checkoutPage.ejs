<!-- include header -->
<%- include('include/_header') %>
<!-- /include header -->

<!-- Main Site -->

<link href="/css/cart.css" rel="stylesheet" />

<main>
  <h1>Order Summary</h1>
  <div class="wrapper">
    <% let total = 0; %>
    <ul class="cart-list">
      <% for (let i = 0; i < cart.length; i++) { %>
      <li class="cart-item">
        <div class="cart-item-details">
          <div class="cart-item-content">
            <h2><%= cart[i].name %></h2>
            <p>Size: <%= cart[i].size %></p>
            <p>Quantity: <%= cart[i].quantity %></p>
          <% total += cart[i].price * cart[i].quantity; %>
          <p>Total: $<%= (cart[i].price * cart[i].quantity).toFixed(2) %></p>
        </div>
      </li>
      <% } %>
    </ul>
    <div class="cart-summary">
      <h2>Total: $<%= total.toFixed(2) %></h2>
    </div>
    <h1>All orders must be paid for IN CASH at the time of pickup at the school store.</h1>
    <div class = input-box>
    <div class="user-inputs">
      <label for="pickup-date">Select Pickup Date:</label>
      <select id="pickup-date" name="pickup-date" required>
        <option value="" disabled selected>Select a date</option>
        <% 
        function localDateString(d) {
          const dt = new Date(d);
          const y = dt.getFullYear();
          const m = String(dt.getMonth() + 1).padStart(2, '0');
          const day = String(dt.getDate()).padStart(2, '0');
          return `${y}-${m}-${day}`;
        }
        
        function formatDateDisplay(d) {
          const dt = new Date(d);
          const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          return `${days[dt.getDay()]}, ${months[dt.getMonth()]} ${dt.getDate()}`;
        }
        
        storeHours.forEach(timeEntry => {
          if (timeEntry.times && timeEntry.times.length > 0) {
            const dateStr = localDateString(timeEntry.date);
            const displayDate = formatDateDisplay(timeEntry.date);
        %>
        <option value="<%= dateStr %>"><%= displayDate %></option>
        <% 
          }
        });
        %>
      </select>
      <label for="pickup-time">Select Pickup Time:</label>
      <select id="pickup-time" name="pickup-time" required disabled>
        <option value="" disabled selected>Select a date first</option>
      </select>
    </div>
    </div>
    <button id="checkout-button" class="checkout-button" >Place Order</button>
    <input type="hidden" id="googleId" value="<%= session.user.googleId %>" />
    <input type="hidden" id="total-cost" value="<%= total.toFixed(2) %>" />
  </div>
</main>


<!-- /Main Site -->

<script>
  // Store hours data for client-side use
  const storeHoursData = <%- JSON.stringify(storeHours.map(entry => ({
    date: entry.date,
    times: entry.times
  }))) %>;
</script>

<script src="/js/checkout.js"></script>

<!-- include footer -->
<%- include('include/_footer') %>
<!-- /include footer -->
